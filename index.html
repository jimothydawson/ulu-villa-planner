<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bali Villa Investment Configurator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Journey Container */
        .journey-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .journey-container.hidden {
            display: none;
        }

        .journey-container.fading {
            opacity: 0;
        }

        /* Journey Steps */
        .journey-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .journey-header h1 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            font-weight: 700;
            letter-spacing: 2px;
            line-height: 1.2;
            opacity: 0.9;
        }

        .journey-header h2 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
            letter-spacing: -1px;
        }

        .journey-header p {
            font-size: 1.1rem;
            opacity: 0.8;
        }

        .step-indicator {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 40px;
        }

        .step-dot {
            width: 10px;
            height: 10px;
            background: #333;
            transition: background 0.3s;
        }

        .step-dot.active {
            background: #fff;
        }

        /* Style Options */
        .style-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 400px;
        }

        .style-option {
            background: #111;
            border: 1px solid #333;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .style-option:hover {
            background: #1a1a1a;
            border-color: #fff;
            transform: translateX(5px);
        }

        .style-option h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            font-weight: 400;
        }

        .style-option p {
            opacity: 0.7;
            font-size: 0.95rem;
        }

        /* Storey Options */
        .storey-options {
            display: flex;
            gap: 20px;
            width: 100%;
            max-width: 900px;
            justify-content: center;
        }

        .storey-column {
            flex: 1;
            min-width: 0;
        }

        .storey-option {
            background: #111;
            border: 1px solid #333;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 200px;
        }

        .storey-option:hover {
            border-color: #fff;
            transform: translateY(-5px);
        }

        .storey-banner {
            background: #fff;
            color: #000;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .storey-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
        }

        .storey-content h3 {
            font-size: 1.5rem;
            margin-bottom: 8px;
            font-weight: 300;
        }

        .storey-content p {
            opacity: 0.7;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .price-text {
            font-size: 1.1rem;
            font-weight: 500;
            opacity: 0.9;
        }

        /* Main Container */
        .main-container {
            display: none;
            min-height: 100vh;
            background: #000;
        }

        .main-container.active {
            display: flex;
        }

        /* Configuration Panel */
        .config-panel {
            background: #111;
            padding: 30px;
            overflow-y: auto;
            border-left: 1px solid #333;
        }

        .config-header {
            margin-bottom: 30px;
        }

        .config-header h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .current-selections {
            display: flex;
            gap: 20px;
            font-size: 0.95rem;
            opacity: 0.8;
        }

        .current-selections span {
            font-weight: 500;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .theme-toggle,
        .view-toggle {
            background: none;
            border: 1px solid #333;
            color: #fff;
            font-size: 1.2rem;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover,
        .view-toggle:hover {
            border-color: #fff;
            transform: scale(1.1);
        }

        .view-toggle.active {
            background: #fff;
            color: #000;
        }

        /* View switching - temporarily disabled */
        .config-selectors {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .summary-section {
            display: block;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #333;
        }

        /* Commented out view switching functionality
        body.summary-view .config-selectors {
            display: none;
        }

        body.summary-view .summary-section {
            display: block;
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }
        */

        .config-group {
            margin-bottom: 25px;
        }

        .inline-label {
            display: block;
            margin-bottom: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0.9;
        }

        .config-group label {
            display: block;
            margin-bottom: 12px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .radio-option {
            position: relative;
        }

        .radio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .radio-option label {
            display: block;
            padding: 16px 20px;
            background: #000;
            border: 1px solid #333;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: none;
            letter-spacing: 0;
            opacity: 1;
            min-width: 80px;
            height: 44px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .radio-option input[type="radio"]:checked + label {
            background: #fff;
            color: #000;
            border-color: #fff;
        }

        .radio-option label:hover {
            border-color: #666;
        }

        .radio-option.disabled label {
            opacity: 0.3;
            cursor: not-allowed;
            background: #111;
            border-color: #222;
        }

        .radio-option.disabled label:hover {
            border-color: #222;
            transform: none;
        }

        .radio-option.disabled input[type="radio"] {
            pointer-events: none;
        }

        /* Image Panel */
        .image-panel {
            position: relative;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 5px;
            min-height: 400px;
            overflow: hidden;
        }

        .villa-image {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
            transition: opacity 0.4s ease;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(1.15);
            transform-origin: center 40%;
            clip-path: inset(0 0 10% 0);
            z-index: 1;
        }

        .villa-image.loading {
            opacity: 0.3;
        }

        .villa-image-next {
            z-index: 2;
        }

        /* Image alignment fixes for balinese variants - compatible with scaling */
        .villa-image[src*="balinese-1s"] {
            transform: translate(-50%, -50%) scale(1.15) translateX(1px);
        }

        .villa-image[src*="balinese-2s"] {
            transform: translate(-50%, -50%) scale(1.15) translateX(-1px);
        }


        .image-placeholder {
            width: 100%;
            max-width: 600px;
            height: 400px;
            background: #111;
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }

        .image-placeholder h3 {
            margin-bottom: 20px;
            font-weight: 300;
        }

        .image-filename {
            margin-top: 15px;
            font-size: 0.85rem;
            opacity: 0.5;
            font-family: monospace;
        }

        /* Summary Section */
        .summary-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #333;
        }

        .summary-section h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #222;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            opacity: 0.8;
        }

        .summary-value {
            font-weight: 500;
        }

        .summary-highlight {
            background: #fff;
            color: #000;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
        }

        .summary-highlight .roi-value {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .summary-highlight .roi-label {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Mobile Drawer */
        .mobile-toggle {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fff;
            color: #000;
            padding: 15px 25px;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            z-index: 1000;
            font-weight: 500;
        }

        /* Desktop Layout */
        @media (min-width: 768px) {
            .main-container {
                flex-direction: row;
            }

            .image-panel {
                flex: 1;
            }

            .config-panel {
                width: 450px;
                flex-shrink: 0;
            }

            .journey-header h1 {
                font-size: 2.2rem;
            }

            .journey-header h2 {
                font-size: 3rem;
            }

            .storey-option {
                height: 250px;
            }
        }

        /* Mobile Layout */
        @media (max-width: 767px) {
            .main-container {
                flex-direction: column;
            }

            .image-panel {
                min-height: 50vh;
                position: relative;
            }

            .config-panel {
                position: static;
                transform: none;
                height: auto;
                border-left: none;
                border-top: 1px solid #333;
                background: #111;
                backdrop-filter: none;
            }

            .mobile-toggle {
                display: none;
            }

            .journey-header h1 {
                font-size: 1.5rem;
            }

            .journey-header h2 {
                font-size: 2rem;
            }

            .storey-options {
                flex-direction: column;
                max-width: 100%;
            }

            .storey-option {
                height: 180px;
            }

            .villa-image {
                width: 100%;
                max-width: 100%;
                height: auto;
                object-fit: contain;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scale(1.15);
                transform-origin: center 40%;
                clip-path: inset(0 0 10% 0);
            }

            .radio-group {
                display: flex;
                flex-wrap: nowrap;
                justify-content: space-between;
                gap: 5px;
                overflow-x: auto;
            }

            .radio-option label {
                padding: 12px 16px;
                min-width: auto;
                height: 44px;
                font-size: 0.85rem;
                white-space: nowrap;
            }

            /* Allow floors and bedrooms to sit in one row on mobile */
            .config-selectors {
                gap: 15px;
            }

            .config-group:nth-child(2),
            .config-group:nth-child(3) {
                flex: 0;
            }

            .floors-bedrooms-row {
                display: flex;
                justify-content: space-between;
                gap: 15px;
            }
        }

        /* Loading State */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #333;
            border-top-color: #fff;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Transitions */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Light Theme */
        body.light-theme {
            background: #fff;
            color: #000;
        }

        .light-theme .journey-container {
            background: #fff;
            color: #000;
        }

        .light-theme .style-option {
            background: #f8f8f8;
            border-color: #ddd;
            color: #000;
        }

        .light-theme .style-option:hover {
            background: #eee;
            border-color: #000;
        }

        .light-theme .storey-option {
            background: #f8f8f8;
            border-color: #ddd;
            color: #000;
        }

        .light-theme .storey-option:hover {
            border-color: #000;
        }

        .light-theme .storey-banner {
            background: #000;
            color: #fff;
        }

        .light-theme .main-container {
            background: #fff;
        }

        .light-theme .config-panel {
            background: #f8f8f8;
            border-left-color: #ddd;
        }

        .light-theme .current-selections {
            color: #000;
        }

        .light-theme .radio-option label {
            background: #fff;
            border-color: #ddd;
            color: #000;
        }

        .light-theme .radio-option input[type="radio"]:checked + label {
            background: #000;
            color: #fff;
            border-color: #000;
        }

        .light-theme .radio-option label:hover {
            border-color: #999;
        }

        .light-theme .image-placeholder {
            background: #f8f8f8;
            border-color: #ddd;
            color: #000;
        }

        .light-theme .loading-spinner {
            border-color: #ddd;
            border-top-color: #000;
        }

        .light-theme .summary-item {
            border-bottom-color: #eee;
        }

        .light-theme .summary-highlight {
            background: #000;
            color: #fff;
        }

        .light-theme .theme-toggle {
            border-color: #ddd;
            color: #000;
        }

        .light-theme .theme-toggle:hover {
            border-color: #000;
        }

        .light-theme .step-dot {
            background: #ddd;
        }

        .light-theme .step-dot.active {
            background: #000;
        }

        /* Journey Theme Toggle */
        .journey-theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        .light-theme .journey-theme-toggle {
            border-color: #ddd;
            color: #000;
        }

        .light-theme .journey-theme-toggle:hover {
            border-color: #000;
        }

        .light-theme .view-toggle {
            border-color: #ddd;
            color: #000;
        }

        .light-theme .view-toggle:hover {
            border-color: #000;
        }

        .light-theme .view-toggle.active {
            background: #000;
            color: #fff;
        }

        .light-theme .radio-option.disabled label {
            opacity: 0.3;
            background: #f0f0f0;
            border-color: #e0e0e0;
            color: #ccc;
        }

        .light-theme .radio-option.disabled label:hover {
            border-color: #e0e0e0;
        }
    </style>
</head>
<body>
    <!-- Journey Step 1: Style Selection -->
    <div class="journey-container" id="step1">
        <button class="theme-toggle journey-theme-toggle" id="journeyThemeToggle1">◐</button>
        <div class="journey-header">
            <h1>BALI VILLA PLANNER<br>BY CASA BOMBORA</h1>
            <h2>Choose Your Villa Style</h2>
            <p>Select the architectural design that matches your vision</p>
        </div>
        <div class="step-indicator">
            <div class="step-dot active"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
        </div>
        <div class="style-options">
            <div class="style-option" data-style="modern">
                <h3>Modern</h3>
                <p>Clean lines, timeless appeal</p>
            </div>
            <div class="style-option" data-style="balinese">
                <h3>Balinese</h3>
                <p>Authentic tropical luxury</p>
            </div>
            <div class="style-option" data-style="zen">
                <h3>Zen</h3>
                <p>Serene minimalist retreat</p>
            </div>
            <div class="style-option" data-style="oasis">
                <h3>Oasis</h3>
                <p>Opulent sanctuary design</p>
            </div>
        </div>
    </div>

    <!-- Journey Step 2: Storey Selection -->
    <div class="journey-container hidden" id="step2">
        <button class="theme-toggle journey-theme-toggle" id="journeyThemeToggle2">◐</button>
        <div class="journey-header">
            <h1>BALI VILLA PLANNER<br>BY CASA BOMBORA</h1>
            <h2>Choose Your Villa Size</h2>
            <!-- <p>Choose the perfect balance of space and investment</p> -->
        </div>
        <div class="step-indicator">
            <div class="step-dot"></div>
            <div class="step-dot active"></div>
            <div class="step-dot"></div>
        </div>
        <div class="storey-options">
            <div class="storey-column">
                <div class="storey-option" data-storeys="1">
                    <div class="storey-banner">Most Affordable</div>
                    <div class="storey-content">
                        <h3>1 Floor</h3>
                        <p>1 bedroom<br><span class="price-text">From 200k AUD</span></p>
                    </div>
                </div>
            </div>
            <div class="storey-column">
                <div class="storey-option" data-storeys="1.5">
                    <div class="storey-banner">Best Value</div>
                    <div class="storey-content">
                        <h3>1.5 Floors</h3>
                        <p>1 or 2 bedrooms with mezzanine<br><span class="price-text">From 250k AUD</span></p>
                    </div>
                </div>
            </div>
            <div class="storey-column">
                <div class="storey-option" data-storeys="2">
                    <div class="storey-banner">Most Spacious</div>
                    <div class="storey-content">
                        <h3>2 Floors</h3>
                        <p>up to 3 bedrooms<br><span class="price-text">From 300k AUD</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Configurator -->
    <div class="main-container" id="configurator">
        <div class="image-panel">
            <img src="" alt="Villa Preview" class="villa-image" id="villaImage" style="display: none;">
            <img src="" alt="Villa Preview" class="villa-image villa-image-next" id="villaImageNext" style="display: none; opacity: 0;">
            <div class="image-placeholder" id="imagePlaceholder">
                <div class="loading-spinner"></div>
                <h3>Loading villa preview...</h3>
            </div>
        </div>

        <div class="config-panel" id="configPanel">
            <div class="config-header">
                <!-- <h2>Villa Configuration</h2> -->
                <div class="header-row">
                    <div class="current-selections">
                        <span id="currentStyle">Modern</span>
                        <span id="currentStoreys">1.5 floors</span>
                        <span id="currentBedrooms">1 bed</span>
                    </div>
                    <div class="header-buttons">
                        <!-- <button class="view-toggle" id="viewToggle">$</button> -->
                        <button class="theme-toggle" id="themeToggle">◐</button>
                    </div>
                </div>
            </div>

            <div class="config-selectors">
                <div class="config-group">
                    <span class="inline-label">Style:</span>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="styleModern" name="style" value="modern">
                            <label for="styleModern">Modern</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="styleBalinese" name="style" value="balinese">
                            <label for="styleBalinese">Balinese</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="styleZen" name="style" value="zen">
                            <label for="styleZen">Zen</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="styleOasis" name="style" value="oasis">
                            <label for="styleOasis">Oasis</label>
                        </div>
                    </div>
                </div>

                <div class="floors-bedrooms-row">
                    <div class="config-group">
                        <span class="inline-label">Floors:</span>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="storey1" name="storeys" value="1">
                                <label for="storey1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="storey15" name="storeys" value="1.5">
                                <label for="storey15">1.5</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="storey2" name="storeys" value="2">
                                <label for="storey2">2</label>
                            </div>
                        </div>
                    </div>

                    <div class="config-group">
                        <span class="inline-label">Bedrooms:</span>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="bed1" name="bedrooms" value="1" checked>
                                <label for="bed1">1</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="bed2" name="bedrooms" value="2">
                                <label for="bed2">2</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="bed3" name="bedrooms" value="3">
                                <label for="bed3">3</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="config-group" style="display: none;">
                    <span class="inline-label">Land:</span>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="land100" name="land" value="100" checked>
                            <label for="land100">100m²</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="land200" name="land" value="200">
                            <label for="land200">200m²</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="summary-section">
                <h3>Investment Summary</h3>
                
                <div class="summary-item">
                    <span class="summary-label">Floor Space</span>
                    <span class="summary-value" id="floorSpace">-</span>
                </div>
                
                <div class="summary-item">
                    <span class="summary-label">Build Cost</span>
                    <span class="summary-value" id="buildCost">-</span>
                </div>
                
                <div class="summary-item">
                    <span class="summary-label">Nightly Rate</span>
                    <span class="summary-value" id="nightlyRate">-</span>
                </div>
                
                <div class="summary-item">
                    <span class="summary-label">Occupancy Rate</span>
                    <span class="summary-value" id="occupancyRate">-</span>
                </div>
                
                <div class="summary-item">
                    <span class="summary-label">Annual Revenue</span>
                    <span class="summary-value" id="annualRevenue">-</span>
                </div>
                
                <div class="summary-item">
                    <span class="summary-label">Annual Expenses (40%)</span>
                    <span class="summary-value" id="annualExpenses">-</span>
                </div>
                
                <div class="summary-item">
                    <span class="summary-label">Annual Profit</span>
                    <span class="summary-value" id="annualProfit">-</span>
                </div>

                <div class="summary-highlight">
                    <div class="roi-value" id="roiValue">-</div>
                    <div class="roi-label">Annual Return on Investment</div>
                </div>
            </div>
        </div>


    </div>

    <script>
        // Configuration state
        const config = {
            bedrooms: 1,
            storeys: 1.5,
            land: 100,
            style: 'modern'
        };

        // Image cache
        const imageCache = new Map();
        let currentImageLoading = false;

        // Pricing data
        const baseCosts = {
            modern: {
                1: { 1: 180000, 2: 200000 },
                1.5: { 1: 230000, 2: 250000 },
                2: { 1: 280000, 2: 300000, 3: 320000 }
            }
        };

        // Style premiums
        const stylePremiums = {
            modern: 0,
            balinese: { 1: 20000, 1.5: 30000, 2: 40000 },
            zen: { 1: 20000, 1.5: 30000, 2: 40000 },
            oasis: { 1: 20000, 1.5: 30000, 2: 40000 }
        };

        // Rental rates
        const baseRentalRates = {
            modern: 200,
            balinese: 220,
            zen: 220,
            oasis: 220
        };

        const rentalPremiums = {
            bedrooms: { 1: 0, 2: 40, 3: 80 },
            storeys: { 1: 0, 1.5: 20, 2: 60 }
        };

        const occupancyRates = {
            1: 0.8,
            2: 0.7,
            3: 0.65
        };

        // Journey flow
        let selectedStyle = null;
        let selectedStoreys = null;

        // Style selection
        document.querySelectorAll('.style-option').forEach(option => {
            option.addEventListener('click', function() {
                selectedStyle = this.dataset.style;
                config.style = selectedStyle;
                
                // Transition to step 2
                const step1 = document.getElementById('step1');
                step1.classList.add('fading');
                
                setTimeout(() => {
                    step1.classList.add('hidden');
                    const step2 = document.getElementById('step2');
                    step2.classList.remove('hidden');
                    step2.classList.add('fade-in');
                }, 300);
            });
        });

        // Storey selection
        document.querySelectorAll('.storey-option').forEach(option => {
            option.addEventListener('click', function() {
                selectedStoreys = parseFloat(this.dataset.storeys);
                config.storeys = selectedStoreys;
                
                // Transition to configurator
                const step2 = document.getElementById('step2');
                step2.classList.add('fading');
                
                setTimeout(() => {
                    step2.classList.add('hidden');
                    
                    // Set pre-selected values
                    document.querySelector(`input[name="style"][value="${selectedStyle}"]`).checked = true;
                    document.querySelector(`input[name="storeys"][value="${selectedStoreys}"]`).checked = true;
                    
                    // Show configurator
                    const configurator = document.getElementById('configurator');
                    configurator.classList.add('active', 'fade-in');
                    
                    // Update everything
                    updateConfiguration();
                }, 300);
            });
        });



        // Configuration changes
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', updateConfiguration);
        });

        function updateConfiguration() {
            // Update config object
            config.bedrooms = parseInt(document.querySelector('input[name="bedrooms"]:checked')?.value || 1);
            config.storeys = parseFloat(document.querySelector('input[name="storeys"]:checked')?.value || 1.5);
            config.land = parseInt(document.querySelector('input[name="land"]:checked')?.value || 100);
            config.style = document.querySelector('input[name="style"]:checked')?.value || 'modern';

            // Update bedroom options based on floors
            updateBedroomOptions();

            // Update current selections display
            updateCurrentSelections();

            // Update image
            updateImage();
            
            // Update calculations
            updateCalculations();
        }

        function updateBedroomOptions() {
            const floors = config.storeys;
            const bed1 = document.querySelector('.radio-option:has(#bed1)');
            const bed2 = document.querySelector('.radio-option:has(#bed2)');
            const bed3 = document.querySelector('.radio-option:has(#bed3)');
            
            // Reset all options
            bed1.classList.remove('disabled');
            bed2.classList.remove('disabled'); 
            bed3.classList.remove('disabled');
            document.getElementById('bed1').disabled = false;
            document.getElementById('bed2').disabled = false;
            document.getElementById('bed3').disabled = false;

            // Apply floor-based restrictions
            if (floors === 1) {
                // 1 floor: only 1 bedroom allowed
                bed2.classList.add('disabled');
                bed3.classList.add('disabled');
                document.getElementById('bed2').disabled = true;
                document.getElementById('bed3').disabled = true;
                
                // If currently selected bedroom is invalid, switch to 1
                if (config.bedrooms > 1) {
                    document.getElementById('bed1').checked = true;
                    config.bedrooms = 1;
                }
            } else if (floors === 1.5) {
                // 1.5 floors: 1 or 2 bedrooms allowed
                bed3.classList.add('disabled');
                document.getElementById('bed3').disabled = true;
                
                // If currently selected bedroom is invalid, switch to 2
                if (config.bedrooms > 2) {
                    document.getElementById('bed2').checked = true;
                    config.bedrooms = 2;
                }
            }
            // 2 floors: all bedrooms allowed (no restrictions needed)
        }

        function updateCurrentSelections() {
            // Update style display
            const styleDisplay = config.style.charAt(0).toUpperCase() + config.style.slice(1);
            document.getElementById('currentStyle').textContent = styleDisplay;

            // Update floors display
            const floorDisplay = config.storeys === 1 ? '1 floor' : 
                                 config.storeys === 1.5 ? '1.5 floors' : '2 floors';
            document.getElementById('currentStoreys').textContent = floorDisplay;

            // Update bedrooms display
            const bedroomDisplay = config.bedrooms === 1 ? '1 bed' : 
                                  config.bedrooms === 2 ? '2 bed' : '3 bed';
            document.getElementById('currentBedrooms').textContent = bedroomDisplay;
        }

        function generateImageFilename() {
            let filename = `${config.style}-${config.storeys}s`;
            
            if (config.land === 200) {
                filename += '-200m2';
            }
            
            filename += '.webp';
            return filename;
        }

        function updateImage() {
            const filename = generateImageFilename();
            const villaImage = document.getElementById('villaImage');
            const villaImageNext = document.getElementById('villaImageNext');
            const placeholder = document.getElementById('imagePlaceholder');
            
            // Check cache first
            if (imageCache.has(filename)) {
                const newSrc = imageCache.get(filename);
                
                // If it's the same image, don't transition
                if (villaImage.src === newSrc) {
                    return;
                }
                
                // Ensure main image is visible and placeholder is hidden
                villaImage.style.display = 'block';
                placeholder.style.display = 'none';
                
                // Prepare the next image
                villaImageNext.src = newSrc;
                villaImageNext.style.display = 'block';
                villaImageNext.style.opacity = '0';
                
                // Start crossfade - fade in next image only
                requestAnimationFrame(() => {
                    villaImageNext.style.opacity = '1';
                });
                
                // Complete transition after animation
                setTimeout(() => {
                    // Temporarily disable transition to prevent flash
                    villaImage.style.transition = 'none';
                    villaImage.src = newSrc;
                    villaImage.style.opacity = '1';
                    villaImageNext.style.opacity = '0';
                    villaImageNext.style.display = 'none';
                    
                    // Re-enable transition after a frame
                    requestAnimationFrame(() => {
                        villaImage.style.transition = '';
                    });
                }, 400);
                
                return;
            }
            
            // Show loading state
            villaImage.classList.add('loading');
            currentImageLoading = true;
            
            // Create new image to test loading
            const testImage = new Image();
            testImage.onload = function() {
                imageCache.set(filename, this.src);
                
                // Ensure main image is visible and placeholder is hidden
                villaImage.style.display = 'block';
                placeholder.style.display = 'none';
                
                // Prepare the next image
                villaImageNext.src = this.src;
                villaImageNext.style.display = 'block';
                villaImageNext.style.opacity = '0';
                
                // Start crossfade - fade in next image only
                requestAnimationFrame(() => {
                    villaImageNext.style.opacity = '1';
                });
                
                // Complete transition after animation
                setTimeout(() => {
                    // Temporarily disable transition to prevent flash
                    villaImage.style.transition = 'none';
                    villaImage.src = this.src;
                    villaImage.classList.remove('loading');
                    villaImage.style.opacity = '1';
                    villaImageNext.style.opacity = '0';
                    villaImageNext.style.display = 'none';
                    currentImageLoading = false;
                    
                    // Re-enable transition after a frame
                    requestAnimationFrame(() => {
                        villaImage.style.transition = '';
                    });
                }, 400);
            };
            
            testImage.onerror = function() {
                // Show placeholder with details
                villaImage.style.display = 'none';
                villaImageNext.style.display = 'none';
                placeholder.style.display = 'flex';
                placeholder.innerHTML = `
                    <h3>Villa Preview</h3>
                    <p>Style: ${config.style.charAt(0).toUpperCase() + config.style.slice(1)}</p>
                    <p>Storeys: ${config.storeys}</p>
                    <p>Land: ${config.land}m²</p>
                    <p style="margin-top: 20px; opacity: 0.5; font-size: 0.85rem;">Image: ${filename}</p>
                `;
                villaImage.classList.remove('loading');
                currentImageLoading = false;
            };
            
            // Simulate image URL (in real app, this would point to actual images)
            testImage.src = `assets/villas/${filename}`;
        }





        function preloadImage(filename) {
            if (!imageCache.has(filename)) {
                const img = new Image();
                img.onload = function() {
                    imageCache.set(filename, this.src);
                };
                img.src = `assets/villas/${filename}`;
            }
        }

        function calculateBuildCost() {
            let cost = baseCosts.modern[config.storeys][config.bedrooms];
            
            // Add style premium
            if (config.style !== 'modern') {
                cost += stylePremiums[config.style][config.storeys];
            }
            
            // Add land size modifier
            if (config.land === 200) {
                cost *= 1.4;
            }
            
            return Math.round(cost);
        }

        function calculateNightlyRate() {
            let rate = baseRentalRates[config.style];
            rate += rentalPremiums.bedrooms[config.bedrooms];
            rate += rentalPremiums.storeys[config.storeys];
            return rate;
        }

        function calculateFloorSpace() {
            const baseSpace = 65.45;
            const multipliers = { 1: 1, 1.5: 1.5, 2: 2 };
            return (baseSpace * multipliers[config.storeys]).toFixed(2);
        }

        function updateCalculations() {
            const buildCost = calculateBuildCost();
            const nightlyRate = calculateNightlyRate();
            const occupancyRate = occupancyRates[config.bedrooms];
            const annualRevenue = nightlyRate * 365 * occupancyRate;
            const annualExpenses = annualRevenue * 0.4;
            const annualProfit = annualRevenue - annualExpenses;
            const roi = (annualProfit / buildCost) * 100;
            const floorSpace = calculateFloorSpace();

            // Update display
            document.getElementById('floorSpace').textContent = `${floorSpace}m²`;
            document.getElementById('buildCost').textContent = `${buildCost.toLocaleString()}`;
            document.getElementById('nightlyRate').textContent = `${nightlyRate}/night`;
            document.getElementById('occupancyRate').textContent = `${(occupancyRate * 100).toFixed(0)}%`;
            document.getElementById('annualRevenue').textContent = `${Math.round(annualRevenue).toLocaleString()}`;
            document.getElementById('annualExpenses').textContent = `${Math.round(annualExpenses).toLocaleString()}`;
            document.getElementById('annualProfit').textContent = `${Math.round(annualProfit).toLocaleString()}`;
            document.getElementById('roiValue').textContent = `${roi.toFixed(1)}%`;
        }

        // Theme switching functionality
        function initializeThemeToggle() {
            const body = document.body;
            
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                body.classList.add('light-theme');
            }
            
            // Theme toggle function
            function toggleTheme() {
                body.classList.toggle('light-theme');
                
                // Save theme preference
                if (body.classList.contains('light-theme')) {
                    localStorage.setItem('theme', 'light');
                } else {
                    localStorage.setItem('theme', 'dark');
                }
            }
            
            // Add click handlers to all theme toggle buttons
            const themeToggles = document.querySelectorAll('.theme-toggle');
            themeToggles.forEach(toggle => {
                toggle.addEventListener('click', toggleTheme);
            });
        }

        // View toggle functionality
        function initializeViewToggle() {
            const viewToggle = document.getElementById('viewToggle');
            const body = document.body;
            
            // Check for saved view preference
            const savedView = localStorage.getItem('configView');
            if (savedView === 'summary') {
                body.classList.add('summary-view');
                viewToggle.classList.add('active');
            }
            
            // View toggle click handler
            viewToggle.addEventListener('click', () => {
                body.classList.toggle('summary-view');
                viewToggle.classList.toggle('active');
                
                // Save view preference
                if (body.classList.contains('summary-view')) {
                    localStorage.setItem('configView', 'summary');
                } else {
                    localStorage.setItem('configView', 'selectors');
                }
            });
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            // Set default values
            document.getElementById('bed1').checked = true;
            document.getElementById('storey15').checked = true;
            document.getElementById('land100').checked = true;
            document.getElementById('styleModern').checked = true;
            
            // Initialize theme toggle
            initializeThemeToggle();
            
            // Initialize view toggle - temporarily disabled
            // initializeViewToggle();
            
            // Start with journey steps (style and storey selection)
            document.getElementById('step1').classList.remove('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('configurator').classList.remove('active');
            
            // Don't load images until user makes selections
            // updateConfiguration() will be called when they reach the configurator
        });




    </script>
</body>
</html>
</html>